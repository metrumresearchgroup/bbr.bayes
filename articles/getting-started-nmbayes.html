<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with bbr.bayes and NONMEM Bayes • bbr.bayes</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with bbr.bayes and NONMEM Bayes">
<meta property="og:description" content="bbr.bayes">
<meta property="og:image" content="https://metrumresearchgroup.github.io/bbr.bayes/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bbr.bayes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/getting-started-nmbayes.html">Getting Started with bbr.bayes and NONMEM Bayes</a>
    </li>
    <li>
      <a href="../articles/getting-started-stan.html">Getting Started with bbr.bayes and Stan</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/metrumresearchgroup/bbr.bayes" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started with bbr.bayes and NONMEM Bayes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/metrumresearchgroup/bbr.bayes/blob/HEAD/vignettes/getting-started-nmbayes.Rmd" class="external-link"><code>vignettes/getting-started-nmbayes.Rmd</code></a></small>
      <div class="hidden name"><code>getting-started-nmbayes.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette takes you through some basic scenarios for modeling with NONMEM Bayes using <code>bbr.bayes</code>, introducing you to its standard workflow and functionality.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metrumresearchgroup.github.io/bbr" class="external-link">bbr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://metrumresearchgroup.github.io/bbr.bayes">bbr.bayes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p><code>bbr.bayes</code> is an extension to <a href="https://metrumresearchgroup.github.io/bbr" class="external-link">bbr</a> which focuses on traceable and reproducible modeling using Bayesian methods. Note that you will also need to load <code>bbr</code> to use most <code>bbr.bayes</code> functionality.</p>
<p>The <code>bbr</code> <a href="https://metrumresearchgroup.github.io/bbr/articles/getting-started.html" class="external-link">“Getting Started with bbr and NONMEM”</a> vignette provides an introduction to modeling with NONMEM using <code>bbr</code>. This vignette covers modeling in NONMEM using Bayesian estimation methods, highlighting ways NONMEM Bayes models in <code>bbr.bayes</code> extend or are different from NONMEM models in <code>bbr</code>.</p>
<p>See the <a href="./getting-started-stan.html">“Getting Started with bbr.bayes and Stan”</a> vignette for an introduction to modeling with <a href="https://mc-stan.org/" class="external-link">Stan</a>.</p>
</div>
<div class="section level2">
<h2 id="installing-and-configuring-bbi">Installing and configuring bbi<a class="anchor" aria-label="anchor" href="#installing-and-configuring-bbi"></a>
</h2>
<p><a href="https://github.com/metrumresearchgroup/bbi" class="external-link">bbi</a> is required to work with NONMEM Bayes models. Below is a high-level overview, but please see the <a href="https://metrumresearchgroup.github.io/bbr/articles/getting-started.html#installing-bbi" class="external-link">“Installing bbi” section</a> of <code>bbr</code>’s “Getting Started with bbr and NONMEM” vignette for detailed instructions.</p>
<p>First, point the <code>bbr.bbi_exe_path</code> option to a path where <code>bbi</code> is or should be installed. This should be done for each R session, so you likely want to include it in your project’s <code>.Rprofile</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span><span class="st">"bbr.bbi_exe_path"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"bin"</span>, <span class="st">"bbi"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Then, if <code>bbi</code> is not already installed at the above location, call <code><a href="https://metrumresearchgroup.github.io/bbr/reference/use_bbi.html" class="external-link">use_bbi()</a></code> to install it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/use_bbi.html" class="external-link">use_bbi</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Finally, use <code><a href="https://metrumresearchgroup.github.io/bbr/reference/bbi_init.html" class="external-link">bbi_init()</a></code> to initialize a directory in which you plan to store models.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MODEL_DIR</span> <span class="op">&lt;-</span> <span class="st">"model/nonmem"</span></span>
<span><span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/bbi_init.html" class="external-link">bbi_init</a></span><span class="op">(</span></span>
<span>  .dir <span class="op">=</span> <span class="va">MODEL_DIR</span>,</span>
<span>  .nonmem_dir <span class="op">=</span> <span class="st">"/opt/NONMEM"</span>,</span>
<span>  .nonmem_version <span class="op">=</span> <span class="st">"nm75"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This needs to be done only once for a given directory.</p>
</div>
<div class="section level2">
<h2 id="creating-a-nonmem-bayes-model-object">Creating a NONMEM Bayes model object<a class="anchor" aria-label="anchor" href="#creating-a-nonmem-bayes-model-object"></a>
</h2>
<p>As in <code>bbr</code>, the <code>bbr.bayes</code> workflow is organized around the concept of <a href="https://metrumresearchgroup.github.io/bbr/articles/getting-started.html#create-model-object" class="external-link">model objects</a>. These are S3 objects which you will pass to <code>bbr</code> and <code>bbr.bayes</code> functions that submit, summarize, or manipulate models. A model object points to a path on disk; the set of files that define a model is derived from this path.</p>
<p>A NONMEM Bayes model is similar to the “regular” NONMEM model from <code>bbr</code>, but it has a more complex structure underneath that is used to represent each MCMC chain. See the <a href="../reference/bbr_nmbayes.html">NONMEM Bayes models in<code>bbr</code></a> reference page for more details.</p>
<div class="section level3">
<h3 id="creating-a-model-object-de-novo">Creating a model object <em>de novo</em><a class="anchor" aria-label="anchor" href="#creating-a-model-object-de-novo"></a>
</h3>
<p>A NONMEM bbr.bayes can be created by calling <code><a href="https://metrumresearchgroup.github.io/bbr/reference/new_model.html" class="external-link">new_model()</a></code> with the path to your control stream <em>without the file extension</em>, in the same way you would create a standard NONMEM model with <code>bbr</code>, as described in the <a href="https://metrumresearchgroup.github.io/bbr/articles/getting-started.html" class="external-link">“Getting Started with bbr and NONMEM”</a> vignette. To tell <code><a href="https://metrumresearchgroup.github.io/bbr/reference/new_model.html" class="external-link">new_model()</a></code> to create a NONMEM Bayes model, pass “nmbayes” as its <code>.model_type</code> argument.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1000</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/new_model.html" class="external-link">new_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">MODEL_DIR</span>, <span class="fl">1000</span><span class="op">)</span>, .model_type <span class="op">=</span> <span class="st">"nmbayes"</span><span class="op">)</span></span>
<span><span class="va">mod1000</span><span class="op">$</span><span class="va">model_type</span></span>
<span><span class="co">#&gt; [1] "nmbayes"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-a-model-object-from-an-existing-model">Creating a model object from an existing model<a class="anchor" aria-label="anchor" href="#creating-a-model-object-from-an-existing-model"></a>
</h3>
<p>While you can create a fresh NONMEM Bayes model with <code><a href="https://metrumresearchgroup.github.io/bbr/reference/new_model.html" class="external-link">new_model()</a></code>, more commonly you will create a new NONMEM Bayes model from an existing model, either a regular NONMEM model (<code>bbi_nonmem_model</code>) or a NONMEM Bayes model (<code>bbi_nmbayes_model</code>).</p>
<div class="section level4">
<h4 id="from-a-regular-nonmem-model">From a regular NONMEM model<a class="anchor" aria-label="anchor" href="#from-a-regular-nonmem-model"></a>
</h4>
<p>To create a NONMEM Bayes model from a regular NONMEM model, use <code><a href="../reference/copy_model_as_nmbayes.html">copy_model_as_nmbayes()</a></code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/read_model.html" class="external-link">read_model</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">MODEL_DIR</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mod1100</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/copy_model_as_nmbayes.html">copy_model_as_nmbayes</a></span><span class="op">(</span><span class="va">mod100</span>, <span class="fl">1100</span>, .inherit_tags <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/update_model_id.html" class="external-link">update_model_id</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/modify_tags.html" class="external-link">replace_tag</a></span><span class="op">(</span><span class="st">"FOCE"</span>, <span class="st">"BAYES"</span><span class="op">)</span></span>
<span><span class="co">#&gt; replacing 100 with 1100 in /tmp/RtmpIYcCkk/nmbayes-vignette-7a2f3554cc2e/model/nonmem/bayes/1100.ctl</span></span>
<span></span>
<span><span class="va">mod100</span><span class="op">$</span><span class="va">model_type</span></span>
<span><span class="co">#&gt; [1] "nonmem"</span></span>
<span><span class="va">mod1100</span><span class="op">$</span><span class="va">model_type</span></span>
<span><span class="co">#&gt; [1] "nmbayes"</span></span></code></pre></div>
<p>That will copy over the control stream and YAML , like <code><a href="https://metrumresearchgroup.github.io/bbr/reference/copy_model_from.html" class="external-link">copy_model_from()</a></code>, and then switch the model type to “nmbayes”. In addition, it will replace the estimation methods with two estimation records that serve as a template for defining a NONMEM Bayes run.</p>
<pre><code>
; TODO: This model was copied by bbr.bayes::copy_model_as_nmbayes().
;       nmbayes models require a METHOD=CHAIN estimation record and a
;       METHOD=BAYES or METHOD=NUTS estimation record. The records
;       below are meant as a starting point.  At the very least, you
;       need to adjust the number of iterations (see NITER option in
;       the second $EST block), but please review all options
;       carefully.
;
;       See ?bbr.bayes::bbr_nmbayes and the NONMEM docs for details.
$EST METHOD=CHAIN FILE=1100.chn NSAMPLE=4 ISAMPLE=0 SEED=1
     CTYPE=0 IACCEPT=0.3 DF=10 DFS=0

$EST METHOD=NUTS SEED=1 NBURN=250 NITER=NNNN
     AUTO=2 CTYPE=0 OLKJDF=2 OVARF=1
     NUTS_DELTA=0.95 PRINT=10 MSFO=1100.msf RANMETHOD=P PARAFPRINT=10000
     BAYES_PHI_STORE=1</code></pre>
</div>
<div class="section level4">
<h4 id="from-a-nonmem-bayes-model">From a NONMEM Bayes model<a class="anchor" aria-label="anchor" href="#from-a-nonmem-bayes-model"></a>
</h4>
<p>To create a NONMEM Bayes from another one, use <code><a href="https://metrumresearchgroup.github.io/bbr/reference/copy_model_from.html" class="external-link">copy_model_from()</a></code>, just as you would in <code>bbr</code> to <a href="https://metrumresearchgroup.github.io/bbr/articles/getting-started.html#iteration" class="external-link">copy and iterate on a model</a>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod1101</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/copy_model_from.html" class="external-link">copy_model_from</a></span><span class="op">(</span><span class="va">mod1100</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/update_model_id.html" class="external-link">update_model_id</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; replacing 1100 with 1101 in /tmp/RtmpIYcCkk/nmbayes-vignette-7a2f3554cc2e/model/nonmem/bayes/1101.ctl</span></span>
<span></span>
<span><span class="co"># Edit control stream...</span></span>
<span></span>
<span><span class="va">mod1101</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/modify_notes.html" class="external-link">add_notes</a></span><span class="op">(</span><span class="va">mod1101</span>, <span class="st">"Switched from foo to bar"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="submitting-a-model">Submitting a model<a class="anchor" aria-label="anchor" href="#submitting-a-model"></a>
</h2>
<p>To execute a model, pass it to <a href="../reference/nmbayes_submit_model.html"><code>submit_model()</code></a>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/submit_model.html" class="external-link">submit_model</a></span><span class="op">(</span><span class="va">mod1100</span><span class="op">)</span></span></code></pre></div>
<p>Underneath the <a href="../reference/nmbayes_submit_model.html"><code>submit_model()</code></a> method of <code>bbi_nmbayes_model</code> objects creates several sub-models, one for generating the initial values and one for each MCMC chain.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/get_path_from_object.html" class="external-link">get_output_dir</a></span><span class="op">(</span><span class="va">mod1100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "1100-1"       "1100-1.ctl"   "1100-1.yaml"  "1100-2"       "1100-2.ctl"  </span></span>
<span><span class="co">#&gt;  [6] "1100-2.yaml"  "init"         "init.chn"     "init.ctl"     "init.yaml"   </span></span>
<span><span class="co">#&gt; [11] "nmbayes.json"</span></span></code></pre></div>
<p>You shouldn’t often need to directly access these sub-models because <code>bbr.bayes</code> implements custom methods and functions to work with them behind the scenes. For example, to monitor running models, you can use <code><a href="https://metrumresearchgroup.github.io/bbr/reference/check_file.html" class="external-link">tail_lst()</a></code> and <code><a href="https://metrumresearchgroup.github.io/bbr/reference/check_file.html" class="external-link">tail_output()</a></code> in the same way as you would with regular NONMEM models. They will print the result for each chain.</p>
</div>
<div class="section level2">
<h2 id="summarizing-a-model">Summarizing a model<a class="anchor" aria-label="anchor" href="#summarizing-a-model"></a>
</h2>
<div class="section level3">
<h3 id="read_fit_model">
<code>read_fit_model()</code><a class="anchor" aria-label="anchor" href="#read_fit_model"></a>
</h3>
<p>Once a model finishes running, an important entry point to summarizing the result is the <code><a href="https://mc-stan.org/posterior/reference/draws_array.html" class="external-link">?posterior::draws_array</a></code> object returned by <code><a href="../reference/read_fit_model.html">read_fit_model()</a></code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_fit_model.html">read_fit_model</a></span><span class="op">(</span><span class="va">mod1100</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  50   2 985</span></span>
<span></span>
<span><span class="co"># Note that real models should use more chains and iterations!</span></span>
<span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws-index.html" class="external-link">niterations</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 50</span></span>
<span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws-index.html" class="external-link">nchains</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span>
<span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws-index.html" class="external-link">nvariables</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 985</span></span></code></pre></div>
<p><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a> provides various functions for inspecting and summarizing posterior draws. For example, you can use <code><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">posterior::summarize_draws()</a></code> to generate a table of summary statistics and diagnostics:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/subset_draws.html" class="external-link">subset_draws</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"THETA"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">posterior</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/posterior/reference/draws_summary.html" class="external-link">summarize_draws</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 10</span></span></span>
<span><span class="co">#&gt;   variable    mean  median     sd    mad     q5   q95  rhat ess_bulk ess_tail</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> THETA[1]  0.207   0.239  0.155  0.150  -<span style="color: #BB0000;">0.128</span> 0.406 1.72      3.72     24.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> THETA[2]  3.97    4.00   0.089<span style="text-decoration: underline;">2</span> 0.080<span style="text-decoration: underline;">9</span>  3.80  4.07  1.68      3.80     18.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> THETA[3]  1.16    1.17   0.027<span style="text-decoration: underline;">1</span> 0.028<span style="text-decoration: underline;">1</span>  1.12  1.20  0.998    81.1     116. </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> THETA[4]  4.31    4.30   0.064<span style="text-decoration: underline;">2</span> 0.059<span style="text-decoration: underline;">4</span>  4.24  4.44  1.45      4.57     24.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> THETA[5]  1.54    1.53   0.101  0.119   1.40  1.73  2.04      3.24     13.3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> THETA[6]  0.503   0.506  0.060<span style="text-decoration: underline;">9</span> 0.067<span style="text-decoration: underline;">1</span>  0.408 0.598 1.03     30.8      24.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> THETA[7] -<span style="color: #BB0000;">0.030</span><span style="color: #BB0000; text-decoration: underline;">7</span> -<span style="color: #BB0000;">0.041</span><span style="color: #BB0000; text-decoration: underline;">6</span> 0.085<span style="text-decoration: underline;">3</span> 0.072<span style="text-decoration: underline;">7</span> -<span style="color: #BB0000;">0.177</span> 0.108 1.04     55.1      79.9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> THETA[8]  0.392   0.387  0.092<span style="text-decoration: underline;">1</span> 0.090<span style="text-decoration: underline;">8</span>  0.231 0.551 1.05     41.1      78.4</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="nm_join_bayes">
<code>nm_join_bayes()</code><a class="anchor" aria-label="anchor" href="#nm_join_bayes"></a>
</h3>
<p><code><a href="../reference/nm_join_bayes.html">nm_join_bayes()</a></code> and <code><a href="../reference/nm_join_bayes.html">nm_join_bayes_quick()</a></code> are functions for joining model output summaries to the input data, in a similar way that <code><a href="https://metrumresearchgroup.github.io/bbr/reference/nm_join.html" class="external-link">bbr::nm_join</a></code> does for non-Bayesian NONMEM models.</p>
<p><code><a href="../reference/nm_join_bayes.html">nm_join_bayes()</a></code> selects a subset of the posterior samples. It uses these as input to a user-defined <a href="https://mrgsolve.org/" class="external-link">mrgsolve</a> model to simulate <code>EPRED</code> and <code>IPRED</code> and then summarizes the simulated values in the result. In addition, it feeds the simulated <code>EPRED</code> values to <a href="https://cran.r-project.org/web/packages/npde/index.html" class="external-link">npde</a> to calculate EWRES and NPDE values.</p>
<p><code><a href="../reference/nm_join_bayes.html">nm_join_bayes_quick()</a></code> does <em>not</em> simulate quantities from the posterior samples. It instead summarizes the reported values from the table files. As the name suggests, this is useful for taking an initial look at the results, though simulation-based values should be used for more reliable estimates.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/nm_join_bayes.html">nm_join_bayes_quick</a></span><span class="op">(</span><span class="va">mod1100</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">NUM</span>, <span class="va">TIME</span>, <span class="va">EPRED</span>, <span class="va">IPRED</span>, <span class="va">NPDE</span>, <span class="va">EWRES</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4,292 × 6</span></span></span>
<span><span class="co">#&gt;      NUM  TIME EPRED IPRED   NPDE  EWRES</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1  0      0     0    0      0    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2  0.61  59.3  65.7 -<span style="color: #BB0000;">0.417</span> -<span style="color: #BB0000;">0.516</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3  1.15  77.8  90.0  0.189  0.128</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4  1.73  83.9  98.6  1.42   1.53 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5  2.15  84.0  99.0  1.75   1.75 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6  3.19  78.3  91.2 -<span style="color: #BB0000;">0.130</span> -<span style="color: #BB0000;">0.220</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7  4.21  69.9  80.4 -<span style="color: #BB0000;">1.23</span>  -<span style="color: #BB0000;">1.10</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8  5.09  62.7  71.5 -<span style="color: #BB0000;">1.81</span>  -<span style="color: #BB0000;">1.57</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9  6.22  54.5  61.6  0.544  0.376</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10  8.09  43.8  49.2  1.43   1.30 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 4,282 more rows</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="accessing-other-information">Accessing other information<a class="anchor" aria-label="anchor" href="#accessing-other-information"></a>
</h3>
<p>If you need access to output files in the chain submodels, you can use the <code><a href="../reference/chain_paths.html">chain_paths()</a></code> helper.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lst_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chain_paths.html">chain_paths</a></span><span class="op">(</span><span class="va">mod1100</span>, extension <span class="op">=</span> <span class="st">".lst"</span><span class="op">)</span></span>
<span><span class="va">tab_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/chain_paths.html">chain_paths</a></span><span class="op">(</span></span>
<span>  <span class="va">mod1100</span>,</span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/get_model_id.html" class="external-link">get_model_id</a></span><span class="op">(</span><span class="va">mod1100</span><span class="op">)</span>, extension <span class="op">=</span> <span class="st">".tab"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_math.html" class="external-link">path_rel</a></span><span class="op">(</span><span class="va">lst_files</span>, <span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/get_path_from_object.html" class="external-link">get_output_dir</a></span><span class="op">(</span><span class="va">mod1100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1100-1/1100-1.lst 1100-2/1100-2.lst</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">lst_files</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 37211 37211</span></span>
<span><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/path_math.html" class="external-link">path_rel</a></span><span class="op">(</span><span class="va">tab_files</span>, <span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/get_path_from_object.html" class="external-link">get_output_dir</a></span><span class="op">(</span><span class="va">mod1100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1100-1/1100.tab 1100-2/1100.tab</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/file.info.html" class="external-link">file.size</a></span><span class="op">(</span><span class="va">tab_files</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 983103 983103</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model_summary">
<code>model_summary()</code><a class="anchor" aria-label="anchor" href="#model_summary"></a>
</h3>
<p>We have <strong>not yet implemented</strong> <code><a href="https://metrumresearchgroup.github.io/bbr/reference/model_summary.html" class="external-link">model_summary()</a></code> for <code>bbi_nmbayes_model</code> objects. This is a work in progress, but the <code><a href="https://mc-stan.org/posterior/reference/draws_array.html" class="external-link">?posterior::draws_array</a></code> object returned by <code><a href="../reference/read_fit_model.html">read_fit_model()</a></code> has <a href="https://mc-stan.org/posterior/reference/index.html#summarizing-and-diagnosing-draws-objects" class="external-link">various methods</a> for summarizing the outputs.</p>
</div>
</div>
<div class="section level2">
<h2 id="run-log-and-friends">Run log and friends<a class="anchor" aria-label="anchor" href="#run-log-and-friends"></a>
</h2>
<p><code><a href="https://metrumresearchgroup.github.io/bbr/reference/run_log.html" class="external-link">run_log()</a></code>, <code><a href="https://metrumresearchgroup.github.io/bbr/reference/config_log.html" class="external-link">config_log()</a></code>, and <code><a href="https://metrumresearchgroup.github.io/bbr/reference/summary_log.html" class="external-link">summary_log()</a></code> will all find and list NONMEM Bayes models.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/run_log.html" class="external-link">run_log</a></span><span class="op">(</span><span class="va">MODEL_DIR</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">run</span>, <span class="va">model_type</span>, <span class="va">tags</span>, <span class="va">notes</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://metrumresearchgroup.github.io/bbr/reference/collapse_to_string.html" class="external-link">collapse_to_string</a></span><span class="op">(</span><span class="va">tags</span>, <span class="va">notes</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 4</span></span></span>
<span><span class="co">#&gt;   run   model_type tags                                notes                   </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 100   nonmem     two-compartment + absorption, FOCE  <span style="color: #BB0000;">NA</span>                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1000  nmbayes    <span style="color: #BB0000;">NA</span>                                  <span style="color: #BB0000;">NA</span>                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1100  nmbayes    two-compartment + absorption, BAYES <span style="color: #BB0000;">NA</span>                      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1101  nmbayes    <span style="color: #BB0000;">NA</span>                                  Switched from foo to bar</span></span></code></pre></div>
<p>Note, however, that <code><a href="https://metrumresearchgroup.github.io/bbr/reference/summary_log.html" class="external-link">summary_log()</a></code> does not currently include include any useful summary statistics or diagnostics for NONMEM Bayes models. This will be revisited once <code><a href="https://metrumresearchgroup.github.io/bbr/reference/model_summary.html" class="external-link">model_summary()</a></code> is implemented (see above).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Seth Green, Kyle Meyer, Tim Waterhouse, Jonathan French, Kyle T Baron.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
